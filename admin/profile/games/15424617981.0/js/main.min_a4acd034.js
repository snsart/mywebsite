var __reflect=this&&this.__reflect||function(t,e,i){t.__class__=e,i?i.push(e):i=[e],t.__types__=t.__types__?i.concat(t.__types__):i},__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);i.prototype=e.prototype,t.prototype=new i},__awaiter=this&&this.__awaiter||function(t,e,i,r){return new(i||(i=Promise))(function(n,a){function o(t){try{l(r.next(t))}catch(e){a(e)}}function s(t){try{l(r["throw"](t))}catch(e){a(e)}}function l(t){t.done?n(t.value):new i(function(e){e(t.value)}).then(o,s)}l((r=r.apply(t,e||[])).next())})},__generator=this&&this.__generator||function(t,e){function i(t){return function(e){return r([t,e])}}function r(i){if(n)throw new TypeError("Generator is already executing.");for(;l;)try{if(n=1,a&&(o=a[2&i[0]?"return":i[0]?"throw":"next"])&&!(o=o.call(a,i[1])).done)return o;switch(a=0,o&&(i=[0,o.value]),i[0]){case 0:case 1:o=i;break;case 4:return l.label++,{value:i[1],done:!1};case 5:l.label++,a=i[1],i=[0];continue;case 7:i=l.ops.pop(),l.trys.pop();continue;default:if(o=l.trys,!(o=o.length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){l=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){l.label=i[1];break}if(6===i[0]&&l.label<o[1]){l.label=o[1],o=i;break}if(o&&l.label<o[2]){l.label=o[2],l.ops.push(i);break}o[2]&&l.ops.pop(),l.trys.pop();continue}i=e.call(t,l)}catch(r){i=[6,r],a=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}var n,a,o,s,l={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return s={next:i(0),"throw":i(1),"return":i(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s},InfoUI=function(t){function e(){var e=t.call(this)||this;return e._score=0,e.create(),e}return __extends(e,t),Object.defineProperty(e.prototype,"value",{get:function(){return this._score},set:function(t){this._score=t,this._inputTxt.text=String(this._score)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"label",{set:function(t){this._label.text=t},enumerable:!0,configurable:!0}),e.prototype.create=function(){this._label=new egret.TextField,this._label.textColor=16776960,this._label.text="score:",this._label.width=100,this._label.height=30,this.addChild(this._label),this._inputTxt=new egret.TextField,this._inputTxt.textColor=16776960,this._inputTxt.x=110,this._inputTxt.text=String(this._score),this.addChild(this._inputTxt)},e}(egret.Sprite);__reflect(InfoUI.prototype,"InfoUI");var AssetAdapter=function(){function t(){}return t.prototype.getAsset=function(t,e,i){function r(r){e.call(i,r,t)}if(RES.hasRes(t)){var n=RES.getRes(t);n?r(n):RES.getResAsync(t,r,this)}else RES.getResByUrl(t,r,this,RES.ResourceItem.TYPE_IMAGE)},t}();__reflect(AssetAdapter.prototype,"AssetAdapter",["eui.IAssetAdapter"]);var Bat=function(t){function e(e){var i=t.call(this)||this;return i._batWidth=150,i._world=World.getInstance(),i._stage=e,i._bat=new egret.Sprite,i._force=[0,-300],i._lastPosition=0,i.createBat(),i.addEvent(),i}return __extends(e,t),Object.defineProperty(e.prototype,"force",{get:function(){return this._force},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"body",{get:function(){return this._batBody},enumerable:!0,configurable:!0}),e.prototype.createBat=function(){this._batBody=new p2.Body({position:[this._stage.stageWidth/2,this._stage.stageHeight-90]});var t=new p2.Box({width:this._batWidth,height:160});this._batBody.addShape(t),this._world.addBody(this._batBody),this.addChild(this._bat),this.render(this._batBody)},e.prototype.render=function(t){var e=t.shapes[0];this._bat.x=t.position[0],this._bat.y=t.position[1],this._bat.graphics.clear(),this._bat.graphics.beginFill(8947848),this._bat.graphics.drawRect(-e.width/2,-e.height/2,e.width,e.height),this._bat.graphics.endFill()},e.prototype.addEvent=function(){var t=this;this._bat.touchEnabled=!0,this._bat.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(e){t._lastPosition=0,t._isTouch=!0},this),this._stage.addEventListener(egret.TouchEvent.TOUCH_MOVE,function(e){t._isTouch&&(t._batBody.position[0]=Math.max(t._batWidth/2+10,Math.min(e.stageX,t._stage.stageWidth-10-t._batWidth/2)),t.force[0]=20*(0==t._lastPosition?0:t._batBody.position[0]-t._lastPosition),t._lastPosition=t._batBody.position[0],t.render(t._batBody))},this)},e}(egret.Sprite);__reflect(Bat.prototype,"Bat");var Brick=function(t){function e(){var e=t.call(this)||this;return e._world=World.getInstance(),e.addBrick(),e}return __extends(e,t),Object.defineProperty(e.prototype,"brickBody",{get:function(){return this._brickBody},enumerable:!0,configurable:!0}),e.prototype.render=function(){this._brick.x=this._brickBody.position[0],this._brick.y=this._brickBody.position[1]},e.prototype.addBrick=function(){this._brickBody=new p2.Body,this._brickBody.displays=[this];var t=new p2.Box({width:50,height:20});this._brickBody.addShape(t),this._world.addBody(this._brickBody),this._brick=new egret.Sprite,this._brick.graphics.beginFill(16776960),this._brick.graphics.drawRect(-t.width/2,-t.height/2,t.width,t.height),this._brick.graphics.endFill(),this.addChild(this._brick)},e.prototype.destroy=function(){this._world.removeBody(this._brickBody),this.parent.removeChild(this)},e}(egret.Sprite);__reflect(Brick.prototype,"Brick");var ButtonUI=function(t){function e(){var e=t.call(this)||this;return e._label="按钮",e.create(),e}return __extends(e,t),Object.defineProperty(e.prototype,"label",{set:function(t){this._label=t,this._labelTxt.text=t},enumerable:!0,configurable:!0}),e.prototype.create=function(){this.graphics.clear(),this.graphics.lineStyle(1,16777215),this.graphics.beginFill(0,.3),this.graphics.drawRoundRect(0,0,100,50,10),this.graphics.endFill(),this._labelTxt=new egret.TextField,this._labelTxt.textColor=16777215,this._labelTxt.textAlign=egret.HorizontalAlign.CENTER,this._labelTxt.verticalAlign=egret.VerticalAlign.MIDDLE,this._labelTxt.text=this.label,this._labelTxt.width=100,this._labelTxt.height=50,this.addChild(this._labelTxt)},e}(egret.Sprite);__reflect(ButtonUI.prototype,"ButtonUI");var endPanelUI=function(t){function e(e,i){var r=t.call(this)||this;return r.width=e,r.height=i,r._replayBtn=new eui.Button,r}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.drawBack(),this.addTitle(),this._score=new InfoUI,this._score.label="score",this._score.x=this.width/2-this._score.width/2,this._score.y=this.height/2,this.addChild(this._score),this._time=new InfoUI,this._time.label="time",this._time.x=this.width/2-this._time.width/2,this._time.y=this._score.y+50,this.addChild(this._time),this._replayBtn.label="replay",this._replayBtn.horizontalCenter=0,this._replayBtn.y=this._time.y+50,this.addChild(this._replayBtn),console.log("addBtn")},Object.defineProperty(e.prototype,"replayBtn",{get:function(){return this._replayBtn},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"time",{get:function(){return this._time},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"score",{get:function(){return this._score},enumerable:!0,configurable:!0}),e.prototype.drawBack=function(){var t=new egret.Shape;t.graphics.clear(),t.graphics.beginFill(2236962),t.graphics.drawRect(0,0,this.width,this.height),t.graphics.endFill(),this.addChild(t)},e.prototype.addTitle=function(){var t=new egret.TextField;t.text="gameOver",t.size=40,t.x=this.width/2-t.width/2,t.y=this.height/4,this.addChild(t)},e}(eui.Group);__reflect(endPanelUI.prototype,"endPanelUI");var Ball=function(t){function e(){var e=t.call(this)||this;return e._world=World.getInstance(),e.addBall(),e}return __extends(e,t),Object.defineProperty(e.prototype,"ballBody",{get:function(){return this._ballBody},enumerable:!0,configurable:!0}),e.prototype.render=function(){this._ball.x=this._ballBody.interpolatedPosition[0],this._ball.y=this._ballBody.interpolatedPosition[1]},e.prototype.addBall=function(){this._ballBody=new p2.Body({mass:1,position:[200,500]});var t=new p2.Circle({radius:15});this._ballBody.addShape(t),this._world.addBody(this._ballBody),this._ball=new egret.Sprite,this._ball.graphics.beginFill(16776960),this._ball.graphics.drawCircle(0,0,t.radius),this._ball.graphics.endFill(),this.addChild(this._ball)},e}(egret.Sprite);__reflect(Ball.prototype,"Ball");var LoadingUI=function(t){function e(){var e=t.call(this)||this;return e.createView(),e}return __extends(e,t),e.prototype.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=300,this.textField.width=480,this.textField.height=100,this.textField.textAlign="center"},e.prototype.onProgress=function(t,e){this.textField.text="Loading..."+t+"/"+e},e}(egret.Sprite);__reflect(LoadingUI.prototype,"LoadingUI",["RES.PromiseTaskReporter"]);var Main=function(t){function e(){var e=t.call(this)||this;return e.contactHandler=function(t){console.log(t.bodyA,t.bodyB),t.bodyA.displays&&t.bodyA.displays[0]instanceof Brick?(e._score.value++,t.bodyA.displays[0].destroy()):t.bodyB.displays&&t.bodyB.displays[0]instanceof Brick&&(e._score.value++,t.bodyB.displays[0].destroy()),(t.bodyA==e._ball.ballBody&&1e3==t.bodyB.id||t.bodyB==e._ball.ballBody&&1e3==t.bodyA.id)&&e.gameOver()},e.preSolveHandler=function(t){for(var i=0;i<t.contactEquations.length;i++){var r=t.contactEquations[i];if(r.bodyA==e._ball.ballBody&&r.bodyB==e._bat.body||r.bodyB==e._ball.ballBody&&r.bodyA==e._bat.body){var n=r.normalA[1];0!=n&&e._ball.ballBody.applyImpulse(e._bat.force,[0,0])}}},e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e}return __extends(e,t),e.prototype.onAddToStage=function(t){egret.lifecycle.addLifecycleListener(function(t){}),egret.lifecycle.onPause=function(){egret.ticker.pause()},egret.lifecycle.onResume=function(){egret.ticker.resume()};var e=new AssetAdapter;egret.registerImplementation("eui.IAssetAdapter",e),egret.registerImplementation("eui.IThemeAdapter",new ThemeAdapter),this.runGame()["catch"](function(t){console.log(t)})},e.prototype.runGame=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.loadResource()];case 1:return t.sent(),this.createGameScene(),[2]}})})},e.prototype.loadResource=function(){return __awaiter(this,void 0,void 0,function(){var t,e;return __generator(this,function(i){switch(i.label){case 0:return i.trys.push([0,4,,5]),t=new LoadingUI,this.stage.addChild(t),[4,RES.loadConfig("resource/default.res.json","resource/")];case 1:return i.sent(),[4,this.loadTheme()];case 2:return i.sent(),[4,RES.loadGroup("preload",0,t)];case 3:return i.sent(),this.stage.removeChild(t),[3,5];case 4:return e=i.sent(),console.error(e),[3,5];case 5:return[2]}})})},e.prototype.loadTheme=function(){var t=this;return new Promise(function(e,i){var r=new eui.Theme("resource/default.thm.json",t.stage);r.addEventListener(eui.UIEvent.COMPLETE,function(){e()},t)})},e.prototype.createGameScene=function(){var t=this;this._world=World.getInstance(),this._startPanel=new StartPanelUI(this.stage.stageWidth,this.stage.stageHeight),this.stage.addChild(this._startPanel),this._startPanel.startBtn.addEventListener("touchBegin",function(e){t.stage.removeChild(t._startPanel),t.initMainScene()},this),this._endPanel=new endPanelUI(this.stage.stageWidth,this.stage.stageHeight),this._endPanel.replayBtn.addEventListener("touchBegin",function(e){t.stage.removeChild(t._endPanel),t.resetGame()},this)},e.prototype.initMainScene=function(){var t=this;this.addBackground(),this.initInfoPanel(),this.addBoundary(),this.addBricks(),this._bat=new Bat(this.stage),this.stage.addChild(this._bat),this._ball=new Ball,this.stage.addChild(this._ball),egret.startTick(this.moveBall,this),this._world.on("beginContact",this.contactHandler),this._world.on("preSolve",this.preSolveHandler),this._timer=new egret.Timer(1e3),this._timer.addEventListener(egret.TimerEvent.TIMER,function(e){t._time.value++},this),this._timer.start()},e.prototype.moveBall=function(t){return this._world.step(1/60,.1,10),this._ball.render(),!1},e.prototype.addBackground=function(){var t=new egret.Sprite;t.x=0,t.y=0,t.graphics.beginFill(3355443),t.graphics.drawRect(0,0,this.stage.stageWidth,this.stage.stageHeight),t.graphics.endFill(),this.addChild(t)},e.prototype.initInfoPanel=function(){this._score=new InfoUI,this._score.label="score",this._score.x=20,this._score.y=10,this._score.value=0,this.stage.addChild(this._score),this._time=new InfoUI,this._time.label="time",this._time.x=400,this._time.y=10,this._time.value=0,this.stage.addChild(this._time)},e.prototype.addBoundary=function(){this.addStaticPanel(10,50,0,1,this.stage.stageWidth-20),this.addStaticPanel(this.stage.stageWidth-10,50,Math.PI/2,2,this.stage.stageHeight-60),this.addStaticPanel(this.stage.stageWidth-10,this.stage.stageHeight-10,Math.PI,1e3,this.stage.stageWidth-20),this.addStaticPanel(10,this.stage.stageHeight-10,270*Math.PI/180,4,this.stage.stageHeight-60)},e.prototype.addStaticPanel=function(t,e,i,r,n){var a=new p2.Body({position:[t,e],angle:i,id:r}),o=new p2.Plane({});a.addShape(o),this._world.addBody(a);var s=new egret.Sprite;s.x=a.position[0],s.y=a.position[1],s.graphics.lineStyle(3,0),s.graphics.moveTo(0,0),s.graphics.lineTo(n,0),s.graphics.endFill(),s.rotation=180*a.angle/Math.PI,this.addChild(s)},e.prototype.addBricks=function(){this._bricks=[];for(var t=0;8>=t;t++)for(var e=0;5>=e;e++){var i=new Brick;i.brickBody.position[0]=80+60*t,i.brickBody.position[1]=200+40*e,i.render(),this._bricks.push(i),this.addChild(i)}},e.prototype.resetGame=function(){var t=this;this._score.value=0,this._time.value=0,this._timer.reset(),this._timer.start(),this._bricks.forEach(function(e){t._world.addBody(e.brickBody),t.addChild(e)},this),this._ball.ballBody.position[0]=200,this._ball.ballBody.position[1]=500,this._world.on("beginContact",this.contactHandler),this._world.on("preSolve",this.preSolveHandler)},e.prototype.gameOver=function(){this._timer.stop(),this.stage.addChild(this._endPanel),this._endPanel.score.value=this._score.value,this._endPanel.time.value=this._time.value,this._world.off("beginContact",this.contactHandler),this._world.off("preSolve",this.preSolveHandler),this._world.has("beginContact",this.contactHandler)&&this._world.off("beginContact",this.contactHandler),this._world.has("preSolve",this.preSolveHandler)&&this._world.off("preSolve",this.preSolveHandler)},e}(egret.DisplayObjectContainer);__reflect(Main.prototype,"Main");var DebugPlatform=function(){function t(){}return t.prototype.getUserInfo=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2,{nickName:"username"}]})})},t.prototype.login=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2]})})},t}();__reflect(DebugPlatform.prototype,"DebugPlatform",["Platform"]),window.platform||(window.platform=new DebugPlatform);var StartPanelUI=function(t){function e(e,i){var r=t.call(this)||this;return r.width=e,r.height=i,r}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.drawBack(),this.addTitle(),this._startBtn=new eui.Button,this._startBtn.label="start",this._startBtn.horizontalCenter=0,this._startBtn.verticalCenter=0,this.addChild(this._startBtn)},Object.defineProperty(e.prototype,"startBtn",{get:function(){return this._startBtn},enumerable:!0,configurable:!0}),e.prototype.drawBack=function(){var t=new egret.Shape;t.graphics.clear(),t.graphics.beginFill(2236962),t.graphics.drawRect(0,0,this.width,this.height),t.graphics.endFill(),this.addChild(t)},e.prototype.addTitle=function(){var t=new egret.TextField;t.text="弹力球",t.size=80,t.x=this.width/2-t.width/2,t.y=this.height/4,this.addChild(t)},e}(eui.Group);__reflect(StartPanelUI.prototype,"StartPanelUI");var ThemeAdapter=function(){function t(){}return t.prototype.getTheme=function(t,e,i,r){function n(t){e.call(r,t)}function a(e){e.resItem.url==t&&(RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,a,null),i.call(r))}var o=this;"undefined"!=typeof generateEUI?egret.callLater(function(){e.call(r,generateEUI)},this):"undefined"!=typeof generateEUI2?RES.getResByUrl("resource/gameEui.json",function(t,i){window.JSONParseClass.setData(t),egret.callLater(function(){e.call(r,generateEUI2)},o)},this,RES.ResourceItem.TYPE_JSON):(RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,a,null),RES.getResByUrl(t,n,this,RES.ResourceItem.TYPE_TEXT))},t}();__reflect(ThemeAdapter.prototype,"ThemeAdapter",["eui.IThemeAdapter"]);var World=function(){function t(){}return t.getInstance=function(){return t._instance||(t._instance=new p2.World({gravity:[0,10.8]}),t._instance.defaultContactMaterial.restitution=1),t._instance},t}();__reflect(World.prototype,"World");